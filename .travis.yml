language: rust

sudo: required

services: docker

addons:
  apt:
    packages:
      - binutils-dev
      - cmake
      - file
      - g++
      - gcc
      - libcurl4-openssl-dev
      - libdw-dev
      - libelf-dev
      - libiberty-dev
      - libudev-dev
      - make
      - pkg-config

matrix:
  include:

    # GNU/Linux - Rust Stable Build
    - env: TARGET=x86_64-unknown-linux-gnu
      name: Cargo Build Rust Stable
      stage: build
      rust: stable
      script: cargo build --features final

    # GNU/Linux - Deploy GÃ¶rli Node
    - env: TARGET=x86_64-unknown-linux-gnu
      name: Deploy Goerli Node
      stage: deploy
      rust: stable
      script: $TRAVIS_BUILD_DIR/target/debug/parity --chain goerli

    # GNU/Linux - Deploy Clique Network
    - env: TARGET=x86_64-unknown-linux-gnu
      name: Deploy Clique Network
      deploy: deploy
      rust: stable
      script: $TRAVIS_BUILD_DIR/clique.sh

    # GNU/Linux - Rust Stable Test
    - env: TARGET=x86_64-unknown-linux-gnu
      name: Cargo Test Rust Stable
      stage: test
      rust: stable
      script:
        - git submodule update --init --recursive
        - $TRAVIS_BUILD_DIR/scripts/validate_chainspecs.sh
        - cargo test --features json-tests,ci-skip-issue,final --all

cache:
  - $HOME/.cargo
  - $TRAVIS_BUILD_DIR/target
before_cache:
  - chmod -R a+r $HOME/.cargo
  - chmod -R a+r $TRAVIS_BUILD_DIR

before_script:
  - rustup self update
  - source ~/.cargo/env || true

after_success: |
  echo "@TODO"
